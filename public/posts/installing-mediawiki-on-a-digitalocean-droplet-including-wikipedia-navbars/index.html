<!DOCTYPE html>
<html lang="en-us"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath: [['\\(', '\\)']]                  
    }
  };
</script>
    










  



<link rel="stylesheet" href="http://localhost:1313/scss/main.css" />


    <script data-goatcounter="https://clintonboys.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
    

    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath: [['\\(', '\\)'], ['$', '$']]                  
    }
  };
</script>

  </head><body>
    <header class="container">
    <nav class="main-nav" id="js-navbar">
      <a class="logo" href="http://localhost:1313/">Clinton Boys</a>
      <ul class="menu" id="js-menu">
        
        
        
          <li class="menu-item">
            <a href="/about/" class="menu-link">About</a>
          </li>
        
        
        
          <li class="menu-item">
            <a href="/now/" class="menu-link">Now</a>
          </li>
        
        
        
          <li class="menu-item">
            <a href="/posts/" class="menu-link">Writing</a>
          </li>
        
        
        
          <li class="menu-item">
            <a href="/projects/" class="menu-link">Projects</a>
          </li>
        
        
        
          <li class="menu-item">
            <a href="http://mtsolitary.com" class="menu-link">Notes</a>
          </li>
        
        
        <li class="menu-item--align">
          <div class="switch">
            <input class="switch-input" type="checkbox" id="themeSwitch">
            <label aria-hidden="true" class="switch-label" for="themeSwitch">On</label>
            <div aria-hidden="true" class="switch-marker"></div>
          </div>
        </li>
      </ul>
      <span class="nav-toggle" id="js-navbar-toggle">
        <svg xmlns="http://www.w3.org/2000/svg" id="Outline" viewBox="0 0 24 24" width="30" height="30" fill="var(--color-contrast-high)"><rect y="11" width="24" height="2" rx="1"/><rect y="4" width="24" height="2" rx="1"/><rect y="18" width="24" height="2" rx="1"/></svg>
      </span>
    </nav>
  </header>
<main class="section">
<div class="single-container-post">
  

  <div class="single-post-contents">
    <div class="single-feature-img">




  


<div class="feature-image-wrap">
<img class="feature-image" 
     srcset="/posts/installing-mediawiki-on-a-digitalocean-droplet-including-wikipedia-navbars/sample-image-9.jpg 480w, /posts/installing-mediawiki-on-a-digitalocean-droplet-including-wikipedia-navbars/sample-image-9.jpg 800w"
     sizes="(max-width: 600px) 480px, 800px"
     src="/posts/installing-mediawiki-on-a-digitalocean-droplet-including-wikipedia-navbars/sample-image-9.jpg"
     alt="Cascade Mountains, Oregon, United States, 2013">
     <div class="feature-image-text">Cascade Mountains, Oregon, United States, 2013</div>
    </div>
</div>
    <article class="markdown">
        <h1 id="installing-mediawiki-on-a-digitalocean-droplet-including-wikipedia-navbars"></h>Installing MediaWiki on a DigitalOcean droplet (including Wikipedia navbars)<a href="#installing-mediawiki-on-a-digitalocean-droplet-including-wikipedia-navbars">
    
  </a>
</h1><p><em>October 10, 2016</em></p>
<p>This post will explain from scratch how to install MediaWiki on a DigitalOcean droplet, including how to set up Wikipedia-style navigation bars. It&rsquo;s something I needed to do for a project I&rsquo;m working on in a volunteer capacity and I had a tough time finding resources so decided to write up a detailed explanation myself. Here I&rsquo;m assuming you&rsquo;re using MacOS or Unix (i.e. some OS with a Unix-based terminal).</p>
<ol>
<li>Start up a DigitalOcean droplet</li>
<li>Install the LAMP stack</li>
<li>Install MediaWiki</li>
<li>Edit LocalSettings.php to allow file uploads and change the logo</li>
<li>Installing and copying relevant extensions and pages</li>
</ol>
<h2 id="1-start-up-a-digitalocean-droplet"></h>1. Start up a DigitalOcean droplet<a href="#1-start-up-a-digitalocean-droplet">
    
  </a>
</h2><p>DigitalOcean is a fantastic provider of VPC (virtual private cloud) services; it&rsquo;s basically a simplified version of AWS which has some great entry-level options for prototyping projects and playing with web services. We&rsquo;re going to use a very basic droplet for this tutorial: the 512MB RAM, single CPU option, which is enough for prototyping. Anything more serious and you&rsquo;ll need to scale up the droplet, which is very easy to do later. Notice we&rsquo;re picking <strong>Ubuntu 14.04.5 x64</strong> as our OS.</p>
<p><img src="https://github.com/clintonboys/clintonboys.github.io/blob/master/_posts/mediawiki1.png?raw=true"
	alt="Choose droplet" 
	class="single-post-image" 
	loading="lazy"
	decoding="async"
	></p>
<p>You don&rsquo;t need to add an SSH key (unless you&rsquo;re really worried about security on your wiki), and you should choose whichever datacenter region is relevant to you. Click Create droplet and you should see the instance spinning up in your list:</p>
<p><img src="https://github.com/clintonboys/clintonboys.github.io/blob/master/_posts/mediawiki2.png?raw=true"
	alt="New instance" 
	class="single-post-image" 
	loading="lazy"
	decoding="async"
	></p>
<p>DigitalOcean have just sent you an email with the root password to your instance: so go to your terminal and</p>
<p><code>ssh root@XXX.XXX.XXX.XXX</code></p>
<p>where the XXXs represent the IP of your new instance. You&rsquo;ll need to type / copy the password from the email, and be prompted to change passwords.</p>
<h2 id="2-install-the-lamp-stack"></h>2. Install the LAMP stack<a href="#2-install-the-lamp-stack">
    
  </a>
</h2><p>Now you&rsquo;re inside your new instance, we need to install the prerequisite software for Mediawiki. LAMP is a name for a commonly used open-source software stack (Linux, the operating system, Apache, the webserver, MySQL, the database layer, and PHP, the dynamic layer).</p>
<p>I don&rsquo;t need to provide many instructions here, as <a href="https://www.digitalocean.com/community/tutorials/how-to-install-linux-apache-mysql-php-lamp-stack-on-ubuntu-14-04" target="_blank" rel="noopener">this tutorial</a> from DigitalOcean provides fantastic step-by-step instructions on how to install everything. You only need to get to the &ldquo;Install PHP modules&rdquo; section; this and everything after is optional.</p>
<p>After completing this tutorial, you need to run a few more commands to get ready for Mediawiki:</p>


  <pre><code>sudo apt-get install php5-intl
sudo apt-get install php5-gd
sudo apt-get install php5-xcache
sudo service apache2 restart</code></pre>
<h2 id="3-install-mediawiki"></h>3. Install MediaWiki<a href="#3-install-mediawiki">
    
  </a>
</h2><p>Now we need to download MediaWiki from source:</p>
<p><code>wget https://releases.wikimedia.org/mediawiki/1.27/mediawiki-1.27.1.tar.gz</code></p>
<p>Once the download has finished, extract it</p>
<p><code>tar xvzf mediawiki-*.tar.gz</code></p>
<p>and move it to the web server document root folder:</p>
<p><code>sudo mv mediawiki-1.27.1/* /var/www/html</code></p>
<p>Now we need to set up a MySQL database for the Wiki to use. Log into MySQL (which you installed in Step 2) with <code>mysql -u root -p</code> and type your password.</p>
<p>You&rsquo;ll need to run a few commands here to set up permissions on the database for the wiki.</p>


  <pre><code>CREATE DATABASE my_wiki;
GRANT INDEX, CREATE, SELECT, INSERT, UPDATE, DELETE, ALTER, LOCK TABLES ON my_wiki.* TO &#39;wikiuser&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;password&#39;;
FLUSH PRIVILEGES;</code></pre>
<p>with <code>password</code> replaced by the password you want. Now you can <code>exit</code> MySQL.</p>
<p>Now we can set up the wiki.</p>
<p>Navigate to http://XXX.XXX.XXX.XX in your browser, with the XXXs replaced by your server&rsquo;s IP. You should see this page:</p>
<p><img src="https://github.com/clintonboys/clintonboys.github.io/blob/master/_posts/mediawiki3.png?raw=true"
	alt="Set up" 
	class="single-post-image" 
	loading="lazy"
	decoding="async"
	></p>
<p>Click set up the wiki and follow the instructions. Most things should be self-explanatory; on the database settings section you will need to enter the settings from before:</p>
<p><img src="https://github.com/clintonboys/clintonboys.github.io/blob/master/_posts/mediawiki4.png?raw=true"
	alt="Database settings" 
	class="single-post-image" 
	loading="lazy"
	decoding="async"
	></p>
<p>You will also have to give your Wiki a name, and decide on on an administrator username and password. At this point you can say you&rsquo;re &ldquo;bored already and just install the wiki&rdquo; and it will install!</p>
<h2 id="4-edit-localsettingsphp-to-allow-file-uploads-and-change-the-logo"></h>4. Edit LocalSettings.php to allow file uploads and change the logo<a href="#4-edit-localsettingsphp-to-allow-file-uploads-and-change-the-logo">
    
  </a>
</h2><p>The process generates a file called <code>LocalSettings.php</code> which downloads to your <strong>local machine</strong>. We need to move this to the server as it contains important settings that you need for customisation.</p>
<p>The easiest way is to open the file on your local machine in a text editor, copy the text, and then run</p>
<p><code>vi /var/www/html/LocalSettings.php</code></p>
<p>on the server, copy the text into the editor, then press <code>ESC</code> and type <code>:wq</code> to save and close the editor.</p>
<p>Now if you navigate to http://XXX.XXX.XXX.XXX/index.php/Main_Page, you should see the basic MediaWiki page:</p>
<p><img src="https://github.com/clintonboys/clintonboys.github.io/blob/master/_posts/mediawiki5.png?raw=true"
	alt="Mediawiki page" 
	class="single-post-image" 
	loading="lazy"
	decoding="async"
	></p>
<p>There are two small changes you&rsquo;re going to want to make to <code>LocalSettings.php</code>: the first is to change the variable <code>$wgLogo</code> to point to whichever image you want to use for your logo. You can put a file on the server and refer to its path, or upload an image to the web and refer to the URL. Note that the image must be exactly 160x160 pixels, and that instead of automatically resizing, MediaWiki just crops this from the top left corner of whichever image you use.</p>
<p>You&rsquo;re also going to want to change the variable <code>$wgEnableUploads</code> to <code>true</code> so that you can upload files to the wiki, and run</p>


  <pre><code>sudo chown -R www-data:www-data images/
sudo chmod -R 755 /var/www/html/images/</code></pre>
<p>to make sure image uploads will be able to write to the directory.</p>
<p>Now a logged-in user to your wiki should see the following; notice the non-standard logo and the Upload file option:</p>
<p><img src="https://github.com/clintonboys/clintonboys.github.io/blob/master/_posts/mediawiki6.png?raw=true"
	alt="Mediawiki page" 
	class="single-post-image" 
	loading="lazy"
	decoding="async"
	></p>
<p>So we have the basic setup working. However this was the easy bit for me: the bit I had trouble with was creating interesting and useful templates like on Wikipedia; for example the navigation bars and boxes which are all over Wikipedia and extremely useful.</p>
<h2 id="5-installing-and-copying-relevant-extensions-and-pages"></h>5. Installing and copying relevant extensions and pages<a href="#5-installing-and-copying-relevant-extensions-and-pages">
    
  </a>
</h2><p>First we need to install the Scribunto extension:</p>


  <pre><code>cd /var/www/html/extensions
wget https://extdist.wmflabs.org/dist/extensions/Scribunto-REL1_27-4da5346.tar.gz
tar xvzf Scribunto-REL1_27-4da5346.tar.gz</code></pre>
<p>and to edit <code>LocalSettings.php</code> (which is one directory up) to add the following two lines to the bottom:</p>


  <pre><code>require_once &#34;$IP/extensions/Scribunto/Scribunto.php&#34;;
$wgScribuntoDefaultEngine = &#39;luastandalone&#39;;</code></pre>
<p>We now need to install the ParserFunctions extension, again in the <code>/extensions</code> directory:</p>


  <pre><code>wget https://extdist.wmflabs.org/dist/extensions/ParserFunctions-REL1_27-d0a5d10.tar.gz</code></pre>
<p>and to add the line</p>


  <pre><code>wfLoadExtension( &#39;ParserFunctions&#39; );</code></pre>
<p>to the bottom of <code>LocalSettings.php</code>.</p>
<p>Now we need to copy two files into our wiki. Navigate to <a href="https://en.wikipedia.org/w/index.php?title=MediaWiki:Common.css&amp;action=edit" target="_blank" rel="noopener">https://en.wikipedia.org/w/index.php?title=MediaWiki:Common.css&action=edit</a>, copy the source code, and then navigate to http://XXX.XXX.XXX.XXX/index.php/MediaWiki:Common.css and paste in the code from Wikipedia.</p>
<p>Do the same for <a href="https://en.wikipedia.org/w/index.php?title=MediaWiki:Common.js&amp;action=edit" target="_blank" rel="noopener">https://en.wikipedia.org/w/index.php?title=MediaWiki:Common.js&action=edit</a>.</p>
<p>Finally, head to <a href="https://en.wikipedia.org/wiki/Special:Export" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Special:Export</a> and export the Navbox template, including all templates:</p>
<p><img src="https://github.com/clintonboys/clintonboys.github.io/blob/master/_posts/mediawiki7.png?raw=true"
	alt="Mediawiki page" 
	class="single-post-image" 
	loading="lazy"
	decoding="async"
	></p>
<p>Now go to http://XXX.XXX.XXX.XXX/index.php/Special:Import, choose the file that Wikipedia just exported and import it to the Template namespace on your wiki.</p>
<p><img src="https://github.com/clintonboys/clintonboys.github.io/blob/master/_posts/mediawiki8.png?raw=true"
	alt="Mediawiki page" 
	class="single-post-image" 
	loading="lazy"
	decoding="async"
	></p>
<p>Upload the file, and now you should be able to include navigation bars!</p>
<p>For example, this source:
produces this page on the wiki:</p>
<p><img src="https://github.com/clintonboys/clintonboys.github.io/blob/master/_posts/mediawiki9.png?raw=true"
	alt="Mediawiki page" 
	class="single-post-image" 
	loading="lazy"
	decoding="async"
	></p>

    </article>
    <aside>
      <div class="single-terms">
        
      </div>
      
        

        
  <section>
    <h2>Read Next</h2>
    <div class="single-next-previous">
      
        <a class="previous" href="http://localhost:1313/posts/my-setup-2016/">&laquo; My setup (2016)</a>
      
      
        <a class="next" href="http://localhost:1313/posts/the-2016-australian-election-new-zealand-rules/">The 2016 Australian election - New Zealand rules &raquo;</a>
      
    </div>
  </section>

      
    </aside>
  </div>  <div class="footer">
    <p class="footer-copyright"><i>&copy; 2014 - 2024
      Clinton Boys. Written, designed and built without the use of generative AI.</i>
      
    </p>
  </div>
</div>

    </main>
  
  








  

<script src="http://localhost:1313/main.js"></script>


</body>
</html>
